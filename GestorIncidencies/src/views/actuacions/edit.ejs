<%- include('../partials/header', { title: 'Editar Actuació #' + actuacio.id }) %>

    <div class="title-box">
        <h1>EDITAR ACTUACIÓ #<%= actuacio.id %></h1>
    </div>

    <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
        <div class="alert alert-danger" style="background-color: #f8d7da; color: #721c24; padding: 10px; border: 1px solid #f5c6cb; border-radius: 4px; margin-bottom: 20px; max-width: 700px; margin-left: auto; margin-right: auto;">
            <%= errorMessage %>
        </div>
    <% } %>

    <form action="/actuacions/<%= actuacio.id %>/update" method="POST" class="incidencias-form" style="width: 80%; max-width: 700px; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #ddd;">

        <div class="form-group">
            <label for="descripcio_actuacio">Descripció de l'actuació:</label>
            <textarea id="descripcio_actuacio" name="descripcio_actuacio" rows="4" required placeholder="Detalla la feina realitzada..."><%= actuacio.descripcio %></textarea>
        </div>

        <div class="form-group">
            <label for="idIncidencia">Per a la Incidència:</label>
            <select id="idIncidencia" name="idIncidencia" required>
                 <option value="" disabled>-- Selecciona Incidència --</option>
                <% if (typeof incidencias !== 'undefined' && incidencias.length > 0) { %>
                    <% incidencias.forEach(incidencia => { %>
                         <option value="<%= incidencia.id %>" <%= actuacio.idIncidencia === incidencia.id ? 'selected' : '' %>>
                            ID: <%= incidencia.id %> - <%= incidencia.descripcio.substring(0, 50) %>...
                        </option>
                    <% }); %>
                <% } %>
            </select>
        </div>

        <div class="form-group">
            <label for="idTecnic">Realitzada per Tècnic:</label>
            <select id="idTecnic" name="idTecnic">
                <option value="" <%= !actuacio.idTecnic ? 'selected' : '' %>>-- No Assignat / Selecciona Tècnic --</option>
                 <% if (typeof tecnics !== 'undefined' && tecnics.length > 0) { %>
                    <% tecnics.forEach(tecnic => { %>
                        <option value="<%= tecnic.id %>" <%= actuacio.idTecnic === tecnic.id ? 'selected' : '' %>>
                            <%= tecnic.nom %>
                        </option>
                    <% }); %>
                <% } %>
            </select>
        </div>

        <div class="form-group">
            <label for="temps_actuacio">Temps dedicat (minuts):</label>
            <input type="number" id="temps_actuacio" name="temps_actuacio" min="0" placeholder="Ex: 30" value="<%= actuacio.temps || '' %>">
        </div>

        <div class="form-group">
             <input type="checkbox" id="visible_actuacio" name="visible_actuacio" value="true" <%= actuacio.visible ? 'checked' : '' %>>
             <label for="visible_actuacio">Aquesta actuació és visible</label>
        </div>

        <div class="form-group">
            <button type="submit">Actualitzar Actuació</button>
            <a href="/actuacions" style="text-decoration: none; padding: 0.8em 1.5em; background-color: #6c757d; color: white; border-radius: 4px; font-size: 1em; margin-left: 1em;">Cancel·lar</a>
        </div>
    </form>

<%- include('../partials/footer') %>
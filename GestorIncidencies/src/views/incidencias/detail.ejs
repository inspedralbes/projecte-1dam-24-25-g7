<%- include('../partials/header', { title: 'Detall Incidència #' + incidencia.id }) %>

    <div class="title-box">
        <h1>INCIDÈNCIA #<%= incidencia.id %></h1>
    </div>

    <div class="incidencias-details" style="width: 80%; max-width: 900px; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #ddd; margin-bottom: 30px;">
        <h2>Detalls</h2>
        <p><strong>Descripció:</strong><br><%= incidencia.description.replace(/\n/g, '<br>') %></p>
        <hr>
        <% // createdAt i updatedAt estan als models per defecte si timestamps = true %>
        <p><strong>Data de creació:</strong> <%= incidencia.createdAt.toLocaleString('ca-ES') %></p>
        <p><strong>Última actualització:</strong> <%= incidencia.updatedAt.toLocaleString('ca-ES') %></p>
        <p><strong>Assignat a Tècnic:</strong> <%= incidencia.Tecnic ? incidencia.Tecnic.nom : 'No assignat' %></p>
        <p><strong>Departament:</strong> <%= incidencia.Departament ? incidencia.Departament.nom : 'N/A' %></p>
        <p><strong>Estat (Resolta):</strong> <%= incidencia.Resolta ? 'Sí' : 'No' %></p>
        <p><strong>Prioritat:</strong> <%= incidencia.prioritat ? incidencia.prioritat : 'No especificada' %></p>

        <% // Mostra les actuacions associades si n'hi ha %>
        <h3>Actuacions:</h3>
        <% if (incidencia.Actuacions && incidencia.Actuacions.length > 0) { %>
            <ul style="list-style: none; padding: 0;">
                <% incidencia.Actuacions.forEach(actuacio => { %>
                    <li style="border-bottom: 1px dashed #eee; padding: 10px 0;">
                        <strong>ID Actuació:</strong> <%= actuacio.id %><br>
                        <strong>Descripció:</strong> <%= actuacio.description %><br>
                        <strong>Temps dedicat (min):</strong> <%= actuacio.Temps || 'N/A' %><br>
                        <strong>Visible:</strong> <%= actuacio.Visible ? 'Sí' : 'No' %><br>
                        <% // Si vols mostrar el tècnic que va fer l'actuació, necessites incloure Tecnic al include de Actuacions a la ruta /:id %>
                        <% // Actualment la ruta només inclou les Actuacions sense el seu Tecnic associat %>
                        <% // Si el router fos modificat per incloure Actuacions amb Tecnic: %>
                        <% // { model: Actuacions, include: [Tecnic] } %>
                        <% // Llavors podríeu fer: %>
                        <% // <strong>Realitzada per:</strong> <%= actuacio.Tecnic ? actuacio.Tecnic.nom : 'N/A' %>
                    </li>
                <% }); %>
            </ul>
        <% } else { %>
            <p>No hi ha actuacions registrades per a aquesta incidència.</p>
        <% } %>


         <div style="margin-top: 20px;">
             <a href="/Incidencias/<%= incidencia.id %>/edit" class="action-buttons" style="background-color: #ffc107; color: black; padding: 8px 15px;">Editar Incidència</a>
             <a href="/Incidencias" class="action-buttons" style="background-color: #6c757d; color: white; padding: 8px 15px; margin-left: 10px;">Tornar a la Llista</a>
         </div>
    </div>

<%- include('../partials/footer') %>
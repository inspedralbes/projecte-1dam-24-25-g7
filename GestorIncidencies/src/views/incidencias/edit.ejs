<%- include('../partials/header', { title: 'Editar Incidència #' + incidencia.id }) %>

    <div class="title-box">
        <h1>EDITAR INCIDÈNCIA #<%= incidencia.id %></h1>
    </div>

    <form action="/Incidencias/<%= incidencia.id %>/update" method="POST" class="incidencias-form" style="width: 80%; max-width: 700px; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #ddd;">

        <% // Eliminat el camp Títol breu, ja que no existeix al model %>

        <!-- Camp Descripció pre-carregat -->
        <div class="form-group">
            <label for="incidencias_desc">Descripció detallada:</label>
            <textarea id="incidencias_desc" name="description" rows="6" required><%= incidencia.description %></textarea>
        </div>

        <!-- Camp Assignat a (pre-seleccionat, permet no assignat) -->
         <div class="form-group">
            <label for="idTecnic">Assignat a Tècnic:</label>
            <select id="idTecnic" name="idTecnic">
                <option value="" <%= !incidencia.idTecnic ? 'selected' : '' %>>-- No Assignat --</option>
                <% tecnics.forEach(tecnic => { %>
                     <% // Assumim que tecnics té id i nom %>
                     <option value="<%= tecnic.id %>" <%= incidencia.idTecnic === tecnic.id ? 'selected' : '' %>>
                         <%= tecnic.nom %>
                     </option>
                <% }); %>
            </select>
        </div>

        <!-- Camp Departament (pre-seleccionat) - REQUERIT pel model -->
         <div class="form-group">
            <label for="idDepartament">Departament:</label>
            <select id="idDepartament" name="idDepartament" required>
                <% // Assumim que departaments té id i nom %>
                <% departaments.forEach(departament => { %>
                     <option value="<%= departament.id %>" <%= incidencia.idDepartament === departament.id ? 'selected' : '' %>>
                         <%= departament.nom %>
                     </option>
                 <% }); %>
             </select>
        </div>


        <!-- Camp Estat (Checkbox Resolta) -->
        <div class="form-group">
            <input type="checkbox" id="incidencia_resolta" name="Resolta" value="true" <%= incidencia.Resolta ? 'checked' : '' %>>
            <label for="incidencia_resolta">Resolta</label>
             <% // Hidden input per enviar "false" si el checkbox no està marcat (és un workaround comú) %>
             <% // També pots gestionar-ho al router comprovant si el camp existeix o no a req.body %>
             <% // Però per simplicitat a la vista, afegim el hidden input %>
             <% if (!incidencia.Resolta) { %>
                <input type="hidden" name="Resolta" value="false">
             <% } %>
        </div>


        <!-- Camp Prioritat (Dropdown) -->
        <div class="form-group">
            <label for="incidencia_prioritat">Prioritat:</label>
            <select id="incidencia_prioritat" name="prioritat">
                 <% // Opcions hardcodejades basades en l'ENUM del model Incidencia %>
                 <option value="" <%= !incidencia.prioritat ? 'selected' : '' %> disabled>-- Selecciona Prioritat --</option>
                 <option value="Alta" <%= incidencia.prioritat === 'Alta' ? 'selected' : '' %>>Alta</option>
                 <option value="mitja" <%= incidencia.prioritat === 'mitja' ? 'selected' : '' %>>Mitja</option>
                 <option value="baixa" <%= incidencia.prioritat === 'baixa' ? 'selected' : '' %>>Baixa</option>
             </select>
        </div>

        <!-- Botons d'acció -->
        <div class="form-group">
            <button type="submit">Actualitzar Incidència</button>
            <a href="/Incidencias" style="text-decoration: none; padding: 0.8em 1.5em; background-color: #6c757d; color: white; border-radius: 4px; font-size: 1em; margin-left: 1em;">Cancel·lar</a>
        </div>

    </form>

<%- include('../partials/footer') %>
<%- include('../partials/header', { title: 'Detall Incidència #' + incidencia.id }) %>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0 title-box-custom" style="font-size: 1.8rem; padding: 1rem 1.5rem; display: inline-block;">INCIDÈNCIA #<%= incidencia.id %></h1>
    <div>
        <a href="/incidencies/<%= incidencia.id %>/edit" class="btn btn-warning btn-lg me-2">Editar Incidència</a>
        <a href="/incidencies" class="btn btn-secondary btn-lg">Tornar a la Llista</a>
    </div>
</div>

<div class="card card-custom mb-4">
    <div class="card-header">
        <h2 class="h5 mb-0 py-2">Detalls de la Incidència</h2>
    </div>
    <div class="card-body p-4">
        <div class="mb-3">
            <h5>Descripció:</h5>
            <p class="lead" style="white-space: pre-wrap;"><%- incidencia.descripcio %></p> {/* white-space: pre-wrap per respectar salts de línia i espais */}
        </div>
        <hr>
        <div class="row g-3">
            <div class="col-md-6">
                <p class="mb-1"><strong>Data de creació:</strong></p>
                <p><%= new Date(incidencia.createdAt).toLocaleString('ca-ES', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) %></p>
                <p class="mb-1"><strong>Última actualització:</strong></p>
                <p><%= new Date(incidencia.updatedAt).toLocaleString('ca-ES', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) %></p>
            </div>
            <div class="col-md-6">
                <p class="mb-1"><strong>Assignat a Tècnic:</strong></p>
                <p><%= incidencia.Tecnic ? incidencia.Tecnic.nom : 'No assignat' %></p>
                <p class="mb-1"><strong>Departament:</strong></p>
                <p><%= incidencia.Departament ? incidencia.Departament.nom : 'N/A' %></p>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-6">
                <p class="mb-1"><strong>Estat:</strong> 
                    <% if (incidencia.resolta) { %>
                        <span class="badge fs-6 bg-accent-menta">Resolta</span>
                    <% } else { %>
                        <span class="badge fs-6 bg-rosa-fosc">Pendent</span>
                    <% } %>
                </p>
            </div>
            <div class="col-md-6">
                <p class="mb-1"><strong>Prioritat:</strong> 
                    <% if (incidencia.prioritat === 'Alta') { %>
                        <span class="badge fs-6 bg-danger"><%= incidencia.prioritat %></span>
                    <% } else if (incidencia.prioritat === 'mitja') { %>
                        <span class="badge fs-6 bg-warning text-dark"><%= incidencia.prioritat %></span>
                    <% } else if (incidencia.prioritat === 'baixa') { %>
                        <span class="badge fs-6 bg-secondary"><%= incidencia.prioritat %></span>
                    <% } else { %>
                        <span class="badge fs-6 bg-light text-dark">No especificada</span>
                    <% } %>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="card card-custom">
    <div class="card-header">
        <h3 class="h5 mb-0 py-2">Actuacions Registrades</h3>
    </div>
    <div class="card-body p-0"> {/* p-0 si la llista ocupa tot */}
        <% if (incidencia.Actuacions && incidencia.Actuacions.length > 0) { %>
            <ul class="list-group list-group-flush">
                <% incidencia.Actuacions.forEach(actuacio => { %>
                    <li class="list-group-item py-3 px-4">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Actuació ID: <%= actuacio.id %></h6>
                            <small class="text-muted">Tècnic: <%= actuacio.Tecnic ? actuacio.Tecnic.nom : 'N/A' %></small>
                        </div>
                        <p class="mb-1"><%= actuacio.descripcio %></p>
                        <small class="text-muted">Temps: <%= actuacio.temps || 'N/E' %> min | Visible: <%= actuacio.visible ? 'Sí' : 'No' %></small>
                    </li>
                <% }); %>
            </ul>
        <% } else { %>
            <p class="mb-0 p-4 text-center">No hi ha actuacions registrades per a aquesta incidència.</p>
        <% } %>
    </div>
</div>

<%- include('../partials/footer') %>
<%- include('../partials/header', { title: 'Detall Incidència #' + incidencia.id }) %>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">INCIDÈNCIA #<%= incidencia.id %></h1>
        <div>
            <a href="/incidencies/<%= incidencia.id %>/edit" class="btn btn-warning me-2">Editar Incidència</a>
            <a href="/incidencies" class="btn btn-secondary">Tornar a la Llista</a>
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h2 class="h5 mb-0">Detalls de la Incidència</h2>
        </div>
        <div class="card-body">
            <p><strong>Descripció:</strong><br><%- incidencia.descripcio.replace(/\n/g, '<br>') %></p>
            <hr>
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><strong>Data de creació:</strong> <%= new Date(incidencia.createdAt).toLocaleString('ca-ES', { dateStyle: 'long', timeStyle: 'short' }) %></p>
                    <p class="mb-1"><strong>Última actualització:</strong> <%= new Date(incidencia.updatedAt).toLocaleString('ca-ES', { dateStyle: 'long', timeStyle: 'short' }) %></p>
                </div>
                <div class="col-md-6">
                    <p class="mb-1"><strong>Assignat a Tècnic:</strong> <%= incidencia.Tecnic ? incidencia.Tecnic.nom : 'No assignat' %></p>
                    <p class="mb-1"><strong>Departament:</strong> <%= incidencia.Departament ? incidencia.Departament.nom : 'N/A' %></p>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><strong>Estat:</strong> 
                        <% if (incidencia.resolta) { %>
                            <span class="badge bg-success">Resolta</span>
                        <% } else { %>
                            <span class="badge bg-warning text-dark">Pendent</span>
                        <% } %>
                    </p>
                </div>
                <div class="col-md-6">
                    <p class="mb-1"><strong>Prioritat:</strong> 
                        <% if (incidencia.prioritat === 'Alta') { %>
                            <span class="badge bg-danger"><%= incidencia.prioritat %></span>
                        <% } else if (incidencia.prioritat === 'mitja') { %>
                            <span class="badge bg-info text-dark"><%= incidencia.prioritat %></span>
                        <% } else if (incidencia.prioritat === 'baixa') { %>
                            <span class="badge bg-secondary"><%= incidencia.prioritat %></span>
                        <% } else { %>
                            No especificada
                        <% } %>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header">
            <h3 class="h5 mb-0">Actuacions Registrades</h3>
        </div>
        <div class="card-body">
            <% if (incidencia.Actuacions && incidencia.Actuacions.length > 0) { %>
                <ul class="list-group list-group-flush">
                    <% incidencia.Actuacions.forEach(actuacio => { %>
                        <li class="list-group-item">
                            <p class="mb-1"><strong>ID Actuació:</strong> <%= actuacio.id %></p>
                            <p class="mb-1"><strong>Descripció:</strong> <%= actuacio.descripcio %></p>
                            <p class="mb-1"><strong>Temps dedicat (min):</strong> <%= actuacio.temps || 'N/A' %></p>
                            <p class="mb-1"><strong>Visible per l'usuari:</strong> <%= actuacio.visible ? 'Sí' : 'No' %></p>
                            <p class="mb-0"><strong>Realitzada per:</strong> <%= actuacio.Tecnic ? actuacio.Tecnic.nom : 'N/A' %></p>
                        </li>
                    <% }); %>
                </ul>
            <% } else { %>
                <p class="mb-0">No hi ha actuacions registrades per a aquesta incidència.</p>
            <% } %>
        </div>
    </div>

<%- include('../partials/footer') %>